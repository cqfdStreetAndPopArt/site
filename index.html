<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="CQFD ‚Äî ≈ìuvres uniques et objets d'art √† vendre. Parcourez nos pi√®ces et ajoutez vos favoris.">
  <title>CQFD</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  <link rel="icon" href="site de vente/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="site de vente/style.css" />
  <script>
    // fix stylesheet / favicon when index.html is opened either from root or inside "site de vente/"
    (function(){
      const prefixes = ['', 'site de vente/'];

      function testLinkHref(url) {
        return new Promise(resolve => {
          const l = document.createElement('link');
          l.rel = 'stylesheet';
          l.href = url;
          l.onload = () => { l.remove(); resolve(true); };
          l.onerror = () => { l.remove(); resolve(false); };
          document.head.appendChild(l);
        });
      }

      async function fixRelHref(selector) {
        const el = document.querySelector(selector);
        if (!el) return;
        const orig = el.getAttribute('href');
        if (!orig || /^(https?:|\/)/.test(orig)) return;
        for (const p of prefixes) {
          try {
            const candidate = p + orig;
            if (selector === 'link[rel="icon"]') {
              // icon: try fetching via Image
              const img = new Image();
              img.onload = () => { el.setAttribute('href', candidate); };
              img.onerror = () => {};
              img.src = candidate;
              // allow some time (best-effort)
              return;
            }
            if (await testLinkHref(candidate)) {
              el.setAttribute('href', candidate);
              return;
            }
          } catch (e) { /* ignore */ }
        }
      }

      // run on DOMContentLoaded so link elements exist
      document.addEventListener('DOMContentLoaded', () => {
        fixRelHref('link[rel="stylesheet"]');
        fixRelHref('link[rel="icon"]');
      });
    })();
  </script>
  <style>
    #cart.open { display: block; }
    #cart {
      display: none;
      position: fixed;
      top: 80px;
      right: 20px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      width: 250px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    #cart-items li { margin-bottom: 8px; }
    .remove-btn {
      margin-left: 10px;
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 2px 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>CQFD</h1>
    <p>≈ìuvres uniques √† vendre</p>
    <nav aria-label="Navigation principale">
      <a href="#">Accueil</a>
      <a href="html/contact.html">Contact</a>
      <a href="#" onclick="toggleCart()" role="button" aria-pressed="false">‚≠êÔ∏è Favoris (<span id="cart-count" aria-live="polite">0</span>)</a>
    </nav>
  </header>

  <section class="controls" aria-hidden="false">
    <div class="controls-inner">
      <label for="search">üîé Rechercher :</label>
      <input id="search" type="search" placeholder="Rechercher un produit, ex: Lego" aria-label="Rechercher des produits">

      <label for="sort">Trier :</label>
      <select id="sort" aria-label="Trier les produits">
        <option value="default">Par d√©faut</option>
        <option value="price-asc">Prix : bas ‚Üí haut</option>
        <option value="price-desc">Prix : haut ‚Üí bas</option>
        <option value="name-asc">Nom A ‚Üí Z</option>
        <option value="name-desc">Nom Z ‚Üí A</option>
      </select>

      <div id="results-count" aria-live="polite" style="margin-left: 1rem;">0 produits</div>
    </div>
  </section>

  <main class="gallery" aria-label="Liste des produits">
    <article class="card" data-title="Bear Brick lumineux" data-price="100">
      <a href="html/produit1.html">
        <picture>
          <source type="image/jpeg" srcset="photo/ourson lumineus/ours bleu.JPG 400w, photo/ourson lumineus/ours bleu.JPG 800w, photo/ourson lumineus/ours bleu.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/ourson lumineus/ours bleu.JPG 400w, photo/ourson lumineus/ours bleu.JPG 800w, photo/ourson lumineus/ours bleu.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/ourson lumineus/ours bleu.JPG" srcset="photo/ourson lumineus/ours bleu.JPG 400w, photo/ourson lumineus/ours bleu.JPG 800w" alt="Bear Brick lumineux" width="400" height="400">
        </picture>
        <h2 class="link-h2">Bear Brick lumineux</h2>
      </a>
      <p class="price">100‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Bear Brick lumineux aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Lego" data-price="250">
      <a href="html/produit2.html">
        <picture>
          <source type="image/jpeg" srcset="photo/lego/lego devanr.JPG 400w, photo/lego/lego devanr.JPG 800w, photo/lego/lego devanr.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/lego/lego devanr.JPG 400w, photo/lego/lego devanr.JPG 800w, photo/lego/lego devanr.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="./photo/lego/lego devanr.JPG" srcset="photo/lego/lego devanr.JPG 400w, photo/lego/lego devanr.JPG 800w" alt="Lego" width="400" height="400">
        </picture>
        <h2 class="link-h2">Lego</h2>
      </a>
      <p class="price">250‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Lego aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Yoshi" data-price="100">
      <a href="html/produit3.html">
        <picture>
          <source type="image/jpeg" srcset="photo/yochi/yochi devant.JPG 400w, photo/yochi/yochi devant.JPG 800w, photo/yochi/yochi devant.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/yochi/yochi devant.JPG 400w, photo/yochi/yochi devant.JPG 800w, photo/yochi/yochi devant.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/yochi/yochi devant.JPG" srcset="photo/yochi/yochi devant.JPG 400w, photo/yochi/yochi devant.JPG 800w" alt="Yoshi" width="400" height="400">
        </picture>
        <h2 class="link-h2">Yoshi</h2>
      </a>
      <p class="price">100‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Yoshi aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Fox N¬∞5" data-price="250">
      <a href="html/produit4.html">
        <picture>
          <source type="image/jpeg" srcset="photo/renard/renard devant.JPG 400w, photo/renard/renard devant.JPG 800w, photo/renard/renard devant.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/renard/renard devant.JPG 400w, photo/renard/renard devant.JPG 800w, photo/renard/renard devant.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/renard/renard devant.JPG" srcset="photo/renard/renard devant.JPG 400w, photo/renard/renard devant.JPG 800w" alt="Fox N¬∞5" width="400" height="400">
        </picture>
        <h2 class="link-h2">Fox N¬∞5</h2>
      </a>
      <p class="price">250‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Fox N¬∞5 aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Bear Brick 50cm" data-price="150">
      <a href="html/produit5.html">
        <picture>
          <source type="image/jpeg" srcset="photo/LV/LV devant.JPG 400w, photo/LV/LV devant.JPG 800w, photo/LV/LV devant.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/LV/LV devant.JPG 400w, photo/LV/LV devant.JPG 800w, photo/LV/LV devant.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/LV/LV devant.JPG" srcset="photo/LV/LV devant.JPG 400w, photo/LV/LV devant.JPG 800w" alt="Bear Brick 50cm" width="400" height="400">
        </picture>
        <h2 class="link-h2">Bear Brick 50cm</h2>
      </a>
      <p class="price">150‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Bear Brick 50cm aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Bear Brick Black And Gold" data-price="150">
      <a href="html/produit6.html">
        <picture>
          <source type="image/jpeg" srcset="photo/Bear Brick Black And Gold/face.JPG 400w, photo/Bear Brick Black And Gold/face.JPG 800w, photo/Bear Brick Black And Gold/face.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/Bear Brick Black And Gold/face.JPG 400w, photo/Bear Brick Black And Gold/face.JPG 800w, photo/Bear Brick Black And Gold/face.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/Bear Brick Black And Gold/face.JPG" srcset="photo/Bear Brick Black And Gold/face.JPG 400w, photo/Bear Brick Black And Gold/face.JPG 800w" alt="Bear Brick Black And Gold" width="400" height="400">
        </picture>
        <h2 class="link-h2">Bear Brick Black And Gold</h2>
      </a>
      <p class="price">150‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Bear Brick Black And Gold aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="L√©go XXL" data-price="150">
      <a href="html/produit7.html">
        <picture>
          <source type="image/jpeg" srcset="photo/l√©go XXL/dev.JPG 400w, photo/l√©go XXL/dev.JPG 800w, photo/l√©go XXL/dev.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/l√©go XXL/dev.JPG 400w, photo/l√©go XXL/dev.JPG 800w, photo/l√©go XXL/dev.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/l√©go XXL/dev.JPG" srcset="photo/l√©go XXL/dev.JPG 400w, photo/l√©go XXL/dev.JPG 800w" alt="L√©go XXL" width="400" height="400">
        </picture>
        <h2 class="link-h2">L√©go XXL</h2>
      </a>
      <p class="price">150‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter L√©go XXL aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Lego XXL (playmobil)" data-price="150">
      <a href="html/produit8.html">
        <picture>
          <source type="image/jpeg" srcset="photo/playmobil/diag.JPG 400w, photo/playmobil/diag.JPG 800w, photo/playmobil/diag.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/playmobil/diag.JPG 400w, photo/playmobil/diag.JPG 800w, photo/playmobil/diag.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/playmobil/diag.JPG" srcset="photo/playmobil/diag.JPG 400w, photo/playmobil/diag.JPG 800w" alt="Lego XXL (playmobil)" width="400" height="400">
        </picture>
        <h2 class="link-h2">Lego XXL</h2>
      </a>
      <p class="price">150‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Lego XXL (playmobil) aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Panneau" data-price="150">
      <a href="html/produit9.html">
        <picture>
          <source type="image/jpeg" srcset="photo/panneau/dev.JPG 400w, photo/panneau/dev.JPG 800w, photo/panneau/dev.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/jpeg" srcset="photo/panneau/dev.JPG 400w, photo/panneau/dev.JPG 800w, photo/panneau/dev.JPG 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img loading="lazy" decoding="async" src="photo/panneau/dev.JPG" srcset="photo/panneau/dev.JPG 400w, photo/panneau/dev.JPG 800w" alt="Panneau" width="400" height="400">
        </picture>
        <h2 class="link-h2">Panneau</h2>
      </a>
      <p class="price">150‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Panneau aux favoris">Ajouter aux favoris</button>
    </article>

    <article class="card" data-title="Ours lumineux" data-price="150">
      <a href="html/produit10.html">
        <picture>
          <source type="image/jpeg" srcset="photo/bear brick rolex/dev.jpg">
          <img loading="lazy" decoding="async" src="photo/bear brick rolex/dev.jpg" alt="Ours lumineux" width="400" height="400">
        </picture>
        <h2 class="link-h2">Ours lumineux</h2>
      </a>
      <p class="price">150‚Ç¨</p>
      <button type="button" class="fav-btn" aria-label="Ajouter Ours lumineux aux favoris">Ajouter aux favoris</button>
    </article>

  </main>

  <aside id="cart">
    <h3>‚≠êÔ∏è Vos Favoris</h3>
    <ul id="cart-items"></ul>
    <p>Total : <span id="cart-total">0</span> ‚Ç¨</p>
    <a href="html/contact.html" class="checkout-button">Passer √† la commande</a>
  </aside>

  <footer>
    <p>&copy; 2025 CQFD. Ce Qu'il Fallait Dessiner.</p>
  </footer>

  <script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function addToCart(button) {
      const card = button.closest('.card');
      if (!card) return;
      const title = card.dataset.title;
      const price = parseFloat(card.dataset.price) || 0;

      // √©viter les doublons
      if (cart.some(item => item.title === title)) {
        alert(title + " est d√©j√† dans vos favoris.");
        return;
      }

      cart.push({ title, price });
      saveCart();
      updateCartDisplay();
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      saveCart();
      updateCartDisplay();
    }

    function updateCartDisplay() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const cartCount = document.getElementById('cart-count');

      if (!cartItems || !cartTotal || !cartCount) return;

      cartItems.innerHTML = '';
      let total = 0;

      cart.forEach((item, index) => {
        const li = document.createElement('li');
        li.textContent = `${item.title} - ${item.price} ‚Ç¨`;

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Supprimer';
        removeBtn.className = 'remove-btn';
        removeBtn.setAttribute('aria-label', 'Supprimer ' + item.title);
        removeBtn.onclick = () => removeFromCart(index);
        removeBtn.type = 'button';

        li.appendChild(removeBtn);
        cartItems.appendChild(li);
        total += item.price;
      });

      cartTotal.textContent = total.toFixed(2);
      cartCount.textContent = cart.length;
      // annonce pour lecteurs d'√©cran
      cartCount.setAttribute('aria-live', 'polite');
    }

    function toggleCart() {
      const cartPanel = document.getElementById('cart');
      if (cartPanel) cartPanel.classList.toggle('open');
      // update aria-pressed on the favorites button
      const favBtn = document.querySelector('nav a[onclick="toggleCart()"]');
      if (favBtn && cartPanel) favBtn.setAttribute('aria-pressed', String(cartPanel.classList.contains('open')));
      if (cartPanel && cartPanel.classList.contains('open')) {
        cartPanel.querySelector('a, button, [tabindex]')?.focus();
      }
    }

    // raccourci clavier: 'f' pour ouvrir les favoris
    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'f' && !e.metaKey && !e.ctrlKey) {
        toggleCart();
      }
    });

    // d√©l√©gation: boutons Ajouter
    document.addEventListener('click', (e) => {
      if (e.target.matches('.fav-btn')) {
        addToCart(e.target);
      }
    });

    /* ---------------- Gallery search / sort / pagination ---------------- */
    const PAGE_SIZE = 1000;
    let currentPage = 1;

    function initGalleryControls() {
      const search = document.getElementById('search');
      const sort = document.getElementById('sort');
      search.addEventListener('input', () => { currentPage = 1; applyFilters(); });
      sort.addEventListener('change', () => { currentPage = 1; applyFilters(); });
      renderPagination();
      applyFilters();
    }

    function getAllCards() {
      return Array.from(document.querySelectorAll('.gallery .card'));
    }

    function applyFilters() {
      const q = document.getElementById('search').value.trim().toLowerCase();
      const sortVal = document.getElementById('sort').value;
      const all = getAllCards();

      let filtered = all.filter(card => {
        const title = (card.dataset.title || '').toLowerCase();
        const price = String(card.dataset.price || '');
        return title.includes(q) || price.includes(q);
      });

      // sorting
      if (sortVal === 'price-asc') filtered.sort((a,b)=> parseFloat(a.dataset.price)-parseFloat(b.dataset.price));
      if (sortVal === 'price-desc') filtered.sort((a,b)=> parseFloat(b.dataset.price)-parseFloat(a.dataset.price));
      if (sortVal === 'name-asc') filtered.sort((a,b)=> (a.dataset.title||'').localeCompare(b.dataset.title||''));
      if (sortVal === 'name-desc') filtered.sort((a,b)=> (b.dataset.title||'').localeCompare(a.dataset.title||''));

      // pagination
      const total = filtered.length;
      const start = (currentPage-1)*PAGE_SIZE;
      const paged = filtered.slice(start, start+PAGE_SIZE);

      document.querySelectorAll('.gallery .card').forEach(c => c.style.display = 'none');
      paged.forEach(c => c.style.display = 'block');

      document.getElementById('results-count').textContent = `${total} produits`;
      renderPagination(Math.ceil(total / PAGE_SIZE));
    }

    function renderPagination(totalPages = 1) {
      const containerId = 'pagination';
      let container = document.getElementById(containerId);
      if (!container) {
        container = document.createElement('div');
        container.id = containerId;
        document.querySelector('.controls-inner').appendChild(container);
      }
      container.innerHTML = '';
      for (let i=1;i<=totalPages;i++){
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = (i===currentPage)?'active':'page-btn';
        btn.type = 'button';
        btn.onclick = () => { currentPage = i; applyFilters(); };
        container.appendChild(btn);
      }
    }

    // ------- fix assets: try both '' and 'site de vente/' prefixes so index works from root or when site de vente is root -------
    function fixAssetPaths() {
      const prefixes = ['', 'site de vente/'];

      function testImage(url) {
        return new Promise(resolve => {
          const img = new Image();
          img.onload = () => resolve(true);
          img.onerror = () => resolve(false);
          img.src = url;
        });
      }

      async function tryFixElementSrc(el, attr) {
        const orig = el.getAttribute(attr);
        if (!orig) return;
        // if already absolute (starts with http or /) skip
        if (/^(https?:|\/)/.test(orig)) return;
        for (const p of prefixes) {
          const candidate = p + orig;
          const ok = await testImage(candidate);
          if (ok) {
            el.setAttribute(attr, candidate);
            return;
          }
        }
      }

      // images
      document.querySelectorAll('img').forEach(img => {
        tryFixElementSrc(img, 'src');
        const ss = img.getAttribute('srcset');
        if (ss) {
          // test first URL in srcset
          const first = ss.split(',')[0].trim().split(' ')[0];
          (async () => {
            for (const p of prefixes) {
              if (await testImage(p + first)) {
                const newSs = ss.split(',').map(part => {
                  const [urlPart, size] = part.trim().split(' ');
                  return (p + urlPart) + (size ? (' ' + size) : '');
                }).join(', ');
                img.setAttribute('srcset', newSs);
                break;
              }
            }
          })();
        }
      });

      // source elements (picture)
      document.querySelectorAll('source').forEach(source => {
        const ss = source.getAttribute('srcset');
        if (!ss) return;
        const first = ss.split(',')[0].trim().split(' ')[0];
        (async () => {
          for (const p of prefixes) {
            if (await testImage(p + first)) {
              const newSs = ss.split(',').map(part => {
                const [urlPart, size] = part.trim().split(' ');
                return (p + urlPart) + (size ? (' ' + size) : '');
              }).join(', ');
              source.setAttribute('srcset', newSs);
              break;
            }
          }
        })();
      });

      // links to product/contact (html/...)
      document.querySelectorAll('a').forEach(a => {
        const href = a.getAttribute('href');
        if (!href) return;
        if (!href.startsWith('http') && (href.startsWith('html/') || href.startsWith('site de vente/html/'))) {
          (async () => {
            for (const p of prefixes) {
              try {
                const res = await fetch(p + href, { method: 'HEAD' });
                if (res.ok) {
                  a.setAttribute('href', p + href);
                  break;
                }
              } catch (e) {
                // try next
              }
            }
          })();
        }
      });
    }

    window.addEventListener('load', () => {
      updateCartDisplay();
      initGalleryControls();
      fixAssetPaths();
    });

  </script>
</body>
</html>