<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Lego - CQFD</title>
  <link rel="stylesheet" href="../style.css" />
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "Lego",
    "image": ["../photo/lego/lego devanr.JPG"],
    "description": "Pièce unique - Lego custom.",
    "offers": { "@type": "Offer", "price": "250", "priceCurrency": "EUR", "availability": "https://schema.org/InStock" }
  }
  </script>
  <style>
    body {
      background-image: url("photo/design-eclaboussure-aquarelle-peinte-main-couleur-arc-ciel_1048-20680.jpg.avif");
    }


    #cart.open { display: block; }
    #cart {
      display: none;
      position: fixed;
      top: 80px;
      right: 20px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      width: 250px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    #cart-items li { margin-bottom: 8px; }
    .remove-btn {
      margin-left: 10px;
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 2px 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>CQFD</h1>
    <nav>
      <a href="../siteDeVente2.html" >Accueil</a>
      <a href="#" onclick="toggleCart()" role="button" aria-pressed="false" aria-controls="cart">⭐️ Favoris (<span id="cart-count">0</span>)</a>
    </nav>
  </header>

  <main class="product-detail">
    <div class="container">
      <div class="thumbnails">
        <img src="../photo/lego/lego devanr-400.webp" onclick="changeImage(this)" alt="Lego - vue 1" width="100" height="150" tabindex="0" role="button">
        <img src="../photo/lego/lego lev le bras-400.webp" onclick="changeImage(this)" alt="Lego - vue 2" width="100" height="150" tabindex="0" role="button">
        <img src="../photo/lego/lego diagonal-400.webp" onclick="changeImage(this)" alt="Lego - vue 3" width="100" height="150" tabindex="0" role="button">
        <img src="../photo/lego/lego dos-400.webp" onclick="changeImage(this)" alt="Lego - vue 4" width="100" height="150" tabindex="0" role="button">

      </div>
      <div class="main-image">
        <picture>
          <source type="image/avif" srcset="../photo/lego/lego devanr-400.avif 400w, ../photo/lego/lego devanr-800.avif 800w, ../photo/lego/lego devanr-1200.avif 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <source type="image/webp" srcset="../photo/lego/lego devanr-400.webp 400w, ../photo/lego/lego devanr-800.webp 800w, ../photo/lego/lego devanr-1200.webp 1200w" sizes="(max-width:600px) 400px, (max-width:900px) 800px, 1200px">
          <img id="largeImage" src="../photo/lego/lego devanr-400.webp" srcset="../photo/lego/lego devanr-400.webp 400w, ../photo/lego/lego devanr-800.webp 800w" alt="Lego - vue principale" loading="lazy" decoding="async" width="475" height="800">
        </picture>
      </div>
      <div class="product-info">
        <h1>Lego Keith Haring</h1>
        <p class="desc">Œuvre unique et originale, inspirée du style pop street art.</p>

        <div class="price-and-button">
          <div class="price"><strong>Prix :</strong> 250€</div>
          <button type="button" class="fav-btn" onclick="(window.addToCartFromProduct || function(){return;})('Lego', 250)" aria-label="Ajouter Lego aux favoris">Ajouter aux favoris</button>
        </div>
      </div>
      </div>
      
    </div>


    <aside id="cart">
      <h3>⭐️ Vos Favoris</h3>
      <ul id="cart-items"></ul>
      <p>Total : <span id="cart-total">0</span> €</p>
      <a href="contact.html" class="checkout-button" >Passer à la commande</a>
    </aside>
  </main>

  <script>
    function changeImage(thumbnail) {
      const src = thumbnail && thumbnail.src ? thumbnail.src : '';
      if (src) document.getElementById('largeImage').src = src;
    }
    document.querySelectorAll('.thumbnails img').forEach(img => {
      img.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); changeImage(img); }
      });
    });

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function addToCart(title, price) {
      if (window.addToCartFromProduct) { window.addToCartFromProduct(title, price); return; }
      if (cart.some(it=>it.title===title)) { alert(title + ' est déjà dans vos favoris.'); return; }
      cart.push({ title, price });
      saveCart();
      updateCartDisplay();
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      saveCart();
      updateCartDisplay();
    }

    function updateCartDisplay() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const cartCount = document.getElementById('cart-count');

      if (!cartItems || !cartTotal || !cartCount) return;

      cartItems.innerHTML = '';
      let total = 0;

      cart.forEach((item, index) => {
        const li = document.createElement('li');
        li.textContent = `${item.title} - ${item.price} €`;

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Supprimer';
        removeBtn.className = 'remove-btn';
        removeBtn.onclick = () => removeFromCart(index);

        li.appendChild(removeBtn);
        cartItems.appendChild(li);
        total += item.price;
      });

      cartTotal.textContent = total.toFixed(2);
      cartCount.textContent = cart.length;
    }

    function toggleCart() {
      const cartPanel = document.getElementById('cart');
      if (cartPanel) cartPanel.classList.toggle('open');
      const favBtn = document.querySelector('nav a[onclick="toggleCart()"]');
      if (favBtn && cartPanel) favBtn.setAttribute('aria-pressed', String(cartPanel.classList.contains('open')));
      if (cartPanel && cartPanel.classList.contains('open')) cartPanel.querySelector('a, button, [tabindex]')?.focus();
    }

    window.onload = updateCartDisplay;
  </script>
</body>
</html>
